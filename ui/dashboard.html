<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>AHP APP Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <style>
      /* Agar tampilan area konten utama scroll jika melebihi tinggi, 
         sementara sidebar fix di sebelah kiri */
      body, html {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      .sidebar {
        background-color: #0d6efd; /* Biru ala Bootstrap */
        color: #fff;
        height: 100vh;
        padding: 20px;
      }
      .sidebar a {
        text-decoration: none;
        color: #fff;
        display: block;
        margin-bottom: 10px;
        border-radius: 5px;
        padding: 8px;
      }
      .sidebar a:hover {
        background-color: #084298;
      }
      .active-menu {
        background-color: #084298;
      }

      .content-area {
        background-color: #f8f9fa;
        height: 100vh;
        overflow-y: auto;
        padding: 20px;
      }

      /* Sembunyikan semua .page kecuali yang di-active-kan */
      .page {
        display: none;
      }
      .page.active {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="row g-0">
      <!-- SIDEBAR -->
      <div class="col-2 sidebar d-flex flex-column">
        <h5 class="fw-bold text-center">AHP APP</h5>
        <div class="w-50 mt-3 justify-content-center align-items-end rounded overflow-hidden" style="margin: auto;height: 150px;">
            <img src="https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?q=80&w=1974&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" class="w-100" style="transform: translateY(-30px);">
        </div>
        <h6 class="text-center fw-bold m-0 p-0 mt-3">Persone One</h6>
        <small class="text-center d-block m-0 p-0">16022025</small>
        <hr class="my-3"> 
        <div id="menuList" class="flex-grow-1">
          <a href="#" data-page="bonusPage" class="menu-link"><i class="bi bi-coin me-2"></i>Halaman Bonus</a>
          <a href="#" data-page="konditePage" class="menu-link"><i class="bi bi-exclamation-circle me-2"></i>Kondite</a>
          <a href="#" data-page="kalibrasiPage" class="menu-link"><i class="bi bi-sliders me-2"></i>Kalibrasi</a>
          <hr class="text-white" />
          <small>Input</small>
          <a href="#" data-page="inputKPIPage" class="menu-link"><i class="bi bi-journal-plus me-2"></i>Input KPI</a>
          <a href="#" data-page="inputPenilaianPage" class="menu-link"><i class="bi bi-pencil-square me-2"></i>Input Penilaian KPI</a>
          <hr class="text-white" />
          <small>Master</small>
          <a href="#" data-page="masterPengurangPage" class="menu-link"><i class="bi bi-file-earmark-minus me-2"></i>Pengurang Poin</a>
          <a href="#" data-page="masterPenambahPage" class="menu-link"><i class="bi bi-file-earmark-plus me-2"></i>Penambah Poin</a>
          <a href="#" data-page="masterSettingKPIPage" class="menu-link"><i class="bi bi-gear-fill me-2"></i>Setting KPI</a>
          <a href="#" data-page="masterKPIPage" class="menu-link"><i class="bi bi-card-checklist me-2"></i>KPI</a>
        </div>
        <button id="logoutBtn" class="btn btn-outline-light w-100 mt-3">
          Logout
        </button>
      </div>
      <!-- CONTENT AREA -->
      <div class="col-10 content-area">
        <!-- Halaman Bonus -->
        <div id="bonusPage" class="page">
          <h3>Halaman Bonus</h3>
          <p>
            Di sini Anda dapat melihat akumulasi bonus dan mengekspor ke Excel.
          </p>
          <button class="btn btn-success">Export Excel</button>
          <br /><br />
          <!-- Tabel Bonus -->
          <div class="table-responsive">
            <table class="table table-bordered">
              <thead class="table-light">
                <tr>
                  <th>No</th>
                  <th>NIP</th>
                  <th>Nama</th>
                  <th>Unit Bisnis</th>
                  <th>Div/Dept</th>
                  <th>Jabatan</th>
                  <th>Tahun</th>
                  <th>Nilai EYR</th>
                  <th>Pengurang Poin</th>
                  <th>Penambah Poin</th>
                  <th>Nilai EYR Kalibrasi</th>
                  <th>Poin Penilaian</th>
                  <th>Dokumen Pendukung</th>
                </tr>
              </thead>
              <tbody id="bonusTableBody">
                <!-- Data Bonus di-load via JS / Axios -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Halaman Kondite -->
        <div id="konditePage" class="page">
          <h3>Kondite</h3>
          <p>Di sini form untuk input kondite karyawan (Surat Peringatan, dsb.).</p>
          <!-- Contoh Form Input Kondite -->
          <form id="konditeForm">
            <div class="mb-3">
              <label class="form-label">Nama Karyawan</label>
              <input type="text" class="form-control" placeholder="Misal: Anggi" />
            </div>
            <div class="mb-3">
              <label class="form-label">Kategori Kondite</label>
              <select class="form-select">
                <option value="">- Pilih -</option>
                <option value="SP1">Surat Peringatan 1</option>
                <option value="SP2">Surat Peringatan 2</option>
                <option value="SP3">Surat Peringatan 3</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Masa Berlaku</label>
              <input type="date" class="form-control" />
            </div>
            <button class="btn btn-primary" type="submit">Simpan Kondite</button>
          </form>
        </div>

        <!-- Halaman Kalibrasi -->
        <div id="kalibrasiPage" class="page">
          <h3>Kalibrasi</h3>
          <p>
            Menampilkan nilai KPI yang sudah dikurangi kondite & ditambah penambah
            poin. Kemudian hasil akhir dinilai (0-5).
          </p>
          <!-- Contoh kalkulasi -->
          <p>
            Hasil Kalibrasi:
            <br />
            &lt;2 = Poor,
            <br />
            2 - &lt;3 = Fair,
            <br />
            3 - &lt;4 = Good,
            <br />
            4 - &lt;5 = Outstanding,
            <br />
            5 = Exceptional
          </p>
        </div>

        <!-- Halaman Input KPI -->
        <div id="inputKPIPage" class="page">
          <h3>Input KPI</h3>
          <p>Tambah kategori KPI (Individu, Departemen, Perusahaan), bobot KPI, dsb.</p>
          <!-- Form input KPI -->
          <form id="inputKPIForm">
            <div class="mb-3">
              <label class="form-label">Kategori KPI</label>
              <select class="form-select" id="kpiCategory">
                <option value="">- Pilih -</option>
                <option value="Individu">KPI Individu</option>
                <option value="Departemen">KPI Departemen</option>
                <option value="Perusahaan">KPI Perusahaan</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Nama KPI</label>
              <input
                type="text"
                class="form-control"
                id="kpiTitle"
                placeholder="Contoh: Target Penjualan"
              />
            </div>
            <div class="mb-3">
              <label class="form-label">Bobot KPI (%)</label>
              <input type="number" class="form-control" id="kpiWeight" placeholder="contoh: 20" />
            </div>
            <div class="mb-3">
              <label class="form-label">Target KPI</label>
              <input type="text" class="form-control" id="kpiTarget" placeholder="contoh: 100 Juta" />
            </div>
            <!-- Penilaian 5 skala: poor, fair, good, outstanding, exceptional -->
            <div class="row">
              <div class="col">
                <label class="form-label">Poor</label>
                <input type="text" class="form-control" />
              </div>
              <div class="col">
                <label class="form-label">Fair</label>
                <input type="text" class="form-control" />
              </div>
              <div class="col">
                <label class="form-label">Good</label>
                <input type="text" class="form-control" />
              </div>
              <div class="col">
                <label class="form-label">Outstanding</label>
                <input type="text" class="form-control" />
              </div>
              <div class="col">
                <label class="form-label">Exceptional</label>
                <input type="text" class="form-control" />
              </div>
            </div>
            <button class="btn btn-primary mt-3" type="submit">Simpan KPI</button>
          </form>
        </div>

        <!-- Halaman Input Penilaian KPI -->
        <div id="inputPenilaianPage" class="page">
          <h3>Input Penilaian KPI</h3>
          <p>Masukkan pencapaian KPI oleh karyawan dsb.</p>
          <!-- Contoh form penilaian KPI -->
          <form>
            <div class="mb-3">
              <label class="form-label">Pilih Karyawan</label>
              <select class="form-select">
                <option value="">- Pilih -</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Pilih KPI</label>
              <select class="form-select">
                <option value="">- Pilih -</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label">Hasil Pencapaian</label>
              <input type="text" class="form-control" placeholder="Contoh: 80 Juta" />
            </div>
            <button class="btn btn-primary" type="submit">Simpan Penilaian</button>
          </form>
        </div>

        <!-- Halaman Master Pengurang Poin -->
        <div id="masterPengurangPage" class="page">
          <h3>Master Pengurang Poin</h3>
          <p>Contoh input SurAT Peringatan 1 (Bobot 1.25), SP2 (1.5), SP3 (2), dll.</p>
        </div>

        <!-- Halaman Master Penambah Poin -->
        <div id="masterPenambahPage" class="page">
          <h3>Master Penambah Poin</h3>
          <p>Contoh: Penghargaan dari BOD (0.25), Project di luar KPI (0.15), dsb.</p>
        </div>

        <!-- Halaman Master Setting KPI -->
        <div id="masterSettingKPIPage" class="page">
          <h3>Master Setting KPI</h3>
          <p>KPI Individu, KPI Departemen, KPI Perusahaan, totalnya harus 100%.</p>
        </div>

        <!-- Halaman Master KPI -->
        <div id="masterKPIPage" class="page">
          <h3>Master KPI</h3>
          <p>Daftar KPI tersedia di sistem: CRUD, dsb.</p>
          <button class="btn btn-primary" id="loadKPI">Load KPI</button>
          <div class="table-responsive mt-3">
            <table class="table table-bordered">
              <thead class="table-light">
                <tr>
                  <th>ID</th>
                  <th>Title</th>
                  <th>Description</th>
                  <th>Score</th>
                  <th>Validated</th>
                </tr>
              </thead>
              <tbody id="kpiTableBody">
                <!-- Data KPI di-load via JS / Axios -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    ></script>
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      // Cek apakah user sudah login (token di localStorage)
      const token = localStorage.getItem('token');
      if (!token) {
        // Jika belum ada token, redirect ke index.html
        window.location.href = 'index.html';
      }

      // Logout button
      const logoutBtn = document.getElementById('logoutBtn');
      logoutBtn.addEventListener('click', () => {
        localStorage.removeItem('token');
        window.location.href = 'index.html';
      });

      // Navbar toggle logic: show/hide pages
      const menuLinks = document.querySelectorAll('.menu-link');
      const pages = document.querySelectorAll('.page');

      menuLinks.forEach((link) => {
        link.addEventListener('click', (e) => {
          e.preventDefault();

          // Hapus class active-menu dari semua link
          menuLinks.forEach((lnk) => lnk.classList.remove('active-menu'));

          // Tambah class active-menu ke link yg diklik
          link.classList.add('active-menu');

          const pageId = link.getAttribute('data-page');
          pages.forEach((pg) => {
            pg.classList.remove('active');
            if (pg.id === pageId) {
              pg.classList.add('active');
            }
          });
        });
      });

      // Fungsi memanggil API KPI (contoh GET /api/kpis)
      const loadKpiBtn = document.getElementById('loadKPI');
      if (loadKpiBtn) {
        loadKpiBtn.addEventListener('click', async () => {
          try {
            const res = await axios.get('http://localhost:8080/api/kpis', {
              headers: {
                Authorization: 'Bearer ' + token,
              },
            });
            const data = res.data.data; // { "data": [ ... ] }
            const tbody = document.getElementById('kpiTableBody');
            tbody.innerHTML = '';
            data.forEach((item) => {
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <td>${item.ID}</td>
                <td>${item.title}</td>
                <td>${item.description}</td>
                <td>${item.score}</td>
                <td>${item.validated}</td>
              `;
              tbody.appendChild(tr);
            });
          } catch (err) {
            alert('Gagal load KPI: ' + err.response?.data?.error);
          }
        });
      }

      // Secara default, tampilkan halaman pertama (misalnya Bonus)
      document.querySelector('[data-page="bonusPage"]').click();
    </script>
  </body>
</html>
